{# Load the tag library #}
{% load bootstrap3 %}


<!--
     Button trigger modal from
     http://getbootstrap.com/javascript/#live-demo
-->

<!-- Modal -->
<div class="modal fade" id="accounts-new" tabindex="-1" role="dialog" aria-labelledby="accounts-new-label">
  <div class="modal-dialog" role="document">
    <div class="modal-content">

      {# {% include "zipline_app/account/_account_form.html" %} #}
      <form action="{% url 'zipline_app:accounts-new' %}" method="post" class="form">
        {% csrf_token %}
        <!-- hidden form field -->
        <input type="hidden" name="source" value="combined">

        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="accounts-new-label">New account</h4>
        </div>

        <div class="modal-body">
          {% bootstrap_form account_form layout='horizontal' %}
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          {% bootstrap_button content="Save" button_type="submit" button_class="btn-primary" %}
        </div>
      </form>

    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="assets-new" tabindex="-1" role="dialog" aria-labelledby="assets-new-label">
  <div class="modal-dialog" role="document">
    <div class="modal-content">

      {# {% include "zipline_app/asset/_asset_form_bootstrap_vanilla.html" %} #}
      <form action="{% url 'zipline_app:assets-new' %}" method="post" class="form">
        {% csrf_token %}
        <!-- hidden form field -->
        <input type="hidden" name="source" value="combined">

        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="assets-new-label">New asset</h4>
        </div>

        <div class="modal-body">
          {% bootstrap_form asset_form layout='horizontal' %}
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          {% bootstrap_button content="Save" button_type="submit" button_class="btn-primary" %}
        </div>
      </form>

    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="orders-new" tabindex="-1" role="dialog" aria-labelledby="orders-new-label">
  <div class="modal-dialog" role="document">
    <div class="modal-content">

      <!--
        <form action="{% url 'zipline_app:orders-new' %}" method="post">
          {% csrf_token %}
          {{ order_form.as_p }}
          <input type="hidden" name="source" value="combined">
          <input type="submit" value="Save" />
        </form>
      -->

      {# {% include "zipline_app/asset/_asset_form_bootstrap_vanilla.html" %} #}
      <form action="{% url 'zipline_app:orders-new' %}" method="post" class="form">
        {% csrf_token %}
        <!-- hidden timestamp -->
        <div style="display: none;">{% bootstrap_field field=order_form.pub_date layout='horizontal' %}</div>

        <!-- hidden form field -->
        <input type="hidden" name="source" value="combined">

        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="orders-new-label">New order</h4>
        </div>

        <div class="modal-body">
          <div class='row'>
            <div class='col-xs-8'>
              {% bootstrap_field field=order_form.pub_date layout='horizontal' %}
            </div>
          </div>

          <div class='row'>
            <div class='col-xs-8'>
              {% bootstrap_field field=order_form.asset layout='horizontal' %}
            </div>
            <div class='col-xs-4'>
              <input class="ac-asset-input" placeholder="Search" />
              <div class="ac-asset-response"></div>
              <div class="ac-asset-status"></div>
            </div>
          </div>

          <div class='row'>
            <div class='col-xs-8'>
              {% bootstrap_field field=order_form.account layout='horizontal' %}
            </div>
            <div class='col-xs-4'>
              <input class="ac-account-input" placeholder="Search" />
              <div class="ac-account-response"></div>
              <div class="ac-account-status"></div>
            </div>
          </div>

          <div class='row'>
            <div class='col-xs-8'>
              {% bootstrap_field field=order_form.order_side layout='horizontal' %}
            </div>
          </div>

          <div class='row'>
            <div class='col-xs-8'>
              {% bootstrap_field field=order_form.amount_unsigned layout='horizontal' %}
            </div>
          </div>

        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          {% bootstrap_button content="Save" button_type="submit" button_class="btn-primary" %}
        </div>
      </form>

    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="fills-new" tabindex="-1" role="dialog" aria-labelledby="fills-new-label">
  <div class="modal-dialog" role="document">
    <div class="modal-content">

      <!--
        <form action="{% url 'zipline_app:fills-new' %}" method="post">
          {% csrf_token %}
          {{ fill_form.as_p }}
          <input type="hidden" name="source" value="combined">
          <input type="submit" value="Save" />
        </form>
      -->

      {# {% include "zipline_app/asset/_asset_form_bootstrap_vanilla.html" %} #}
      <form action="{% url 'zipline_app:fills-new' %}" method="post" class="form">
        {% csrf_token %}

        <!-- hidden form field -->
        <input type="hidden" name="source" value="combined">

        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="fills-new-label">New fill</h4>
        </div>

        <div class="modal-body">
          <div class='row'>
            <div class='col-xs-8'>
              {% bootstrap_field field=fill_form.pub_date layout='horizontal' %}
            </div>
          </div>

          <div class='row'>
            <div class='col-xs-8'>
              {% bootstrap_field field=fill_form.asset layout='horizontal' %}
            </div>
            <div class='col-xs-4'>
              <input class="ac-asset-input form-control" placeholder="Search" />
              <div class="ac-asset-response"></div>
              <div class="ac-asset-status"></div>
            </div>
          </div>

          <div class='row'>
            <div class='col-xs-8'>
              {% bootstrap_field field=fill_form.fill_side layout='horizontal' %}
            </div>
          </div>

          <div class='row'>
            <div class='col-xs-8'>
              {% bootstrap_field field=fill_form.fill_qty_unsigned layout='horizontal' %}
            </div>
          </div>

          <div class='row'>
            <div class='col-xs-8'>
              {% bootstrap_field field=fill_form.fill_price layout='horizontal' %}
            </div>
          </div>

          <div class='row'>
            <div class='col-xs-8'>
              {% bootstrap_field field=fill_form.tt_order_key layout='horizontal' %}
            </div>
          </div>

          <div class='row'>
            <div class='col-xs-8'>
              {% bootstrap_field field=fill_form.fill_text layout='horizontal' %}
            </div>
          </div>

          <div class='row'>
            <div class='col-xs-8'>
              {% bootstrap_field field=fill_form.dedicated_to_order layout='horizontal' %}
            </div>
          </div>

        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          {% bootstrap_button content="Save" button_type="submit" button_class="btn-primary" %}
        </div>
      </form>

    </div>
  </div>
</div>

<script type="text/javascript">
$(function() {
  <!-- How to reset form body in bootstrap modal box
       http://stackoverflow.com/questions/15827262/ddg#20918538
       -->
  $('.modal').on('hidden.bs.modal', function(){
        $(this).find('form')[0].reset();
        $(this).find('input').prop('disabled',false);
        $(this).find('select').prop('disabled',false);
        $(this).find('hidden.extra-dyn').remove();
  });



  <!-- convert asset/account input to autocomplete from jquery ui -->
  function createAutocomplete(id,name) {
    $(id+" .ac-"+name+"-input").autocomplete({
      source: "/autocomplete/"+name+"/",
      appendTo: $(id+" .ac-"+name+"-response"),
      response: function( event, ui ) {
        if(ui.content.length==0) {
          $(id+" .ac-"+name+"-status").text("No results");
        } else {
          $(id+" .ac-"+name+"-status").text("");
        }
      },
      search: function( event, ui ) {
        $(id+" .ac-"+name+"-status").text("Searching...");
      },
      autoFocus: true,
      select: function( event, ui ) {
        $(id+" form select[name='"+name+"']").val(ui.item.value);
        $(id+" .ac-"+name+"-input").val("");
        event.preventDefault();
      }
    });
  }

  createAutocomplete("#orders-new","account");
  createAutocomplete("#orders-new","asset");
  createAutocomplete("#fills-new","asset");

});
</script>
