{% extends "zipline_app/base.html" %}
{% load humanize %}
{% load poll_extras %}

{# Load the tag library #}
{% load bootstrap3 %}

{# Load CSS and JavaScript #}
{% bootstrap_css %}
{% bootstrap_javascript %}

{% block content %}

{% if zl_unused|length > 0 %}
<div class="alert alert-danger">
  Assets with extra fills:
  <ul>
  {% for asset,qty in zl_unused %}
    <li>{{asset.symbol}}: {{qty}}</li>
  {% endfor %}
  </ul>
</div>
{% endif %}

  {# {% include "zipline_app/asset/_asset_form_bootstrap_vanilla.html" %} #}
<form action="{% url 'zipline_app:assets-new' %}" method="post" class="form">
  {% csrf_token %}
  {% bootstrap_form asset_form layout='horizontal' %}
  {% bootstrap_button content="Add" icon="plus" button_type="submit" %}
</form>

<!--
  <form action="{% url 'zipline_app:orders-new' %}" method="post">
    {% csrf_token %}
    {{ order_form.as_p }}
    <input type="hidden" name="source" value="combined">
    <input type="submit" value="Save" />
  </form>
-->

  <div class="container">
    <em>
      <div class="row">
        <div class="col-xs-1"><!-- timestamp --></div>
        <div class="col-xs-10">
          <div class="row">
            <div class="col-xs-7">
              <div class="row">
                <div class="col-xs-2"><!-- asset --></div>
                <div class="col-xs-10 text-left"><b>Orders</b></div>
              </div>
            </div>
            <div class="col-xs-5">
              <div class="row">
                <div class="col-xs-2"><!-- asset --></div>
                <div class="col-xs-10">
                  <div class="row">
                    <div class="col-xs-2"><!-- not sure what this is --></div>
                    <div class="col-xs-10 text-left"><b>Fills</b></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xs-1"><!-- timestamp --></div>
      </div>
    </em>

    <em>
      <div class="row">
        <div class="col-xs-1"><!-- timestamp --></div>
        <div class="col-xs-10">
          <div class="row">
            <div class="col-xs-7">
              <div class="row">
                <div class="col-xs-2"><b>Symbol</b></div>
                <div class="col-xs-10">
                  <div class="row">
                    <div class="col-xs-3">Account</div>
                    <div class="col-xs-2 text-right"><abbr title="Quantity">Q</abbr></div>
                    <div class="col-xs-2 text-right"><abbr title="Filled">F</abbr></div>
                    <div class="col-xs-3 text-right"><abbr title="Average Price">P</abbr></div>
                    <div class="col-xs-2"></div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-xs-5">
              <div class="row">
                <div class="col-xs-2">Symbol</div>

                <div class="col-xs-10">
                  <div class="row">
                    <div class="col-xs-4 text-right"><abbr title="Quantity">Q</abbr></div>
                    <div class="col-xs-4 text-right"><abbr title="Price">P</abbr></div>
                    <div class="col-xs-4"></div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
        <div class="col-xs-1"><!-- timestamp --></div>
      </div>
    </em>

    <div class="row">
      <div class="col-xs-1"><!-- timestamp --></div>
      <div class="col-xs-10">
        <div class="row">

          <div class="col-xs-7">
            <form action="{% url 'zipline_app:orders-new' %}" method="post" class="form">
              {% csrf_token %}
              <!-- hidden timestamp -->
              <div style="display: none;">{% bootstrap_field field=order_form.pub_date layout='inline' %}</div>
              <!-- hidden form field -->
              <input type="hidden" name="source" value="combined">

              <div class="row">
                <div class="col-xs-2">
                  <div class="row">
                    {% bootstrap_field field=order_form.asset layout='inline' %}
                  </div>
                </div>
                <div class="col-xs-10">
                  <div class="row">
                    <div class="col-xs-3">
                      {% bootstrap_field field=order_form.account layout='inline' %}
                    </div>
                    <div class="col-xs-2 text-right">
                      {% bootstrap_field field=order_form.amount layout='inline' %}
                    </div>
                    <div class="col-xs-2 text-right">
                      {% bootstrap_button content="Add" icon="plus" button_type="submit" %}
                    </div>
                    <div class="col-xs-3 text-right"></div>
                    <div class="col-xs-2"></div>
                  </div>
                </div>
              </div>
            </form>
          </div>

          <div class="col-xs-5">
            <form action="{% url 'zipline_app:fills-new' %}" method="post" class="form">
              {% csrf_token %}
              <div class="row">
                <div class="col-xs-2">
                  {% bootstrap_field field=fill_form.asset layout='inline' %}
                </div>
                <div class="col-xs-10">
                  <div class="row">
                    <div class="col-xs-4 text-right">
                      {% bootstrap_field field=fill_form.fill_qty layout='inline' %}
                    </div>
                    <div class="col-xs-4 text-right">
                      {% bootstrap_field field=fill_form.fill_price layout='inline' %}
                    </div>
                    <div class="col-xs-4">
                      {% bootstrap_button content="Add" icon="plus" button_type="submit" %}
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>

        </div>
      </div>
      <div class="col-xs-1"><!-- timestamp --></div>
    </div>

    {% for minute in combined %}
    <hr style="margin-top:5px;margin-bottom:5px">
    <div class="row">
        <div class="col-xs-1 text-right">
          <em>
            <div class="row"><b>{{minute.minute|strftime:"%H:%M"}}</b></div>
            <div class="row small text-muted">{{minute.minute|strftime:"%Y-%m-%d"}}</div>
          </em>
        </div>

        <div class="col-xs-10">
          {% for duo in minute.duos %}
          <div class="row">
            <div class="col-xs-7">
              <div class="row">
                <div class="col-xs-2">
                  {% if duo.orders|length > 0 %}
                  {{duo.asset.asset_symbol}}
                  {% endif %}
                </div>

                <div class="col-xs-10">
                  {% include 'zipline_app/_index_orders.html' %}
                </div>
              </div>
            </div>
            <div class="col-xs-5">
              <div class="row">
                <div class="col-xs-2">
                  {% if duo.fills|length > 0 %}
                  {{duo.asset.asset_symbol}}
                  {% endif %}
                </div>

                <div class="col-xs-10">
                  {% include 'zipline_app/_index_fills.html' %}
                </div>
              </div>
            </div>

          </div>
          {% endfor %}
        </div>

        <div class="col-xs-1 text-left">
          <em>
            <div class="row"><b>{{minute.minute|strftime:"%H:%M"}}</b></div>
            <div class="row small text-muted">{{minute.minute|strftime:"%Y-%m-%d"}}</div>
          </em>
        </div>

    </div>
    {% empty %}
      No orders are available.
    {% endfor %}

  </div>

{% endblock %}
